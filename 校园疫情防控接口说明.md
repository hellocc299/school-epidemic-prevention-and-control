# 校园疫情防控系统接口API
Epidemic prevention and control

## 1. 接口说明

### 1. 返回状态及说明

| 状态码 |        含义        |            说明            |
| :----: | :----------------: | :------------------------: |
|  200   |         OK         |          请求成功          |
|  401   |    Unauthorized    |         token无效          |
|  403   |     Forbidden      |         请求被拒绝         |
|  404   |     Not Found      |        找不到该资源        |
|  405   | Method Not Allowed |       请求方法被禁止       |
|  417   | Expectation Failed | 请求失败(网络、格式等错误) |

### 2. 支持请求的方法(Restful)

GET、POST、PATCH、DELECT

### 3. 数据库设计

详见sql结构

## 2. 接口

### 1. 公共部分

#### 1. 登录

- 请求路径：/users/login
- 请求方法：post
- 请求参数

|  参数名  |            参数说明            | 数据类型 |   备注   |
| :------: | :----------------------------: | :------: | :------: |
| username |             用户名             |  string  | 不为null |
| password |              密码              |  string  | 不为null |
|   type   | 类型（1.管理员 2.学生 3.老师） |   int    | 不为null |

- 响应参数

| 状态码(status) |       返回参数及说明       |               额外返回参数                |
| :------------: | :------------------------: | :---------------------------------------: |
|      200       |          登录成功          | queryData: { loginData(用户信息), token } |
|      403       | 用户名、密码和类型不可为空 |                                           |
|      403       |         用户不存在         |                                           |
|      403       |          密码错误          |                                           |
|      417       |  由于网络问题，获取失败！  |                                           |

#### 2. 上传头像

- 请求路径：/users/setavatar
- 请求方法：patch(如果存在头像就更新头像)
- 请求参数

| 参数名 | 参数说明 | 数据类型 |   备注   |
| :----: | :------: | :------: | :------: |
| avatar |   文件   |          | 不为null |

- 响应参数(这里的200和417为sendStatusHandle，后面一致的话可用)

| 状态码(status) |      返回参数及说明      | 额外返回参数 |
| :------------: | :----------------------: | :----------: |
|      200       |        操作成功！        |              |
|      401       |        token无效         |              |
|      417       | 由于网络原因，发送失败！ |              |

#### 3. 修改密码

- 请求路径：/users/uppwd
- 请求方法：patch
- 请求参数(前端需要再次对新密码格式进行校验，为6-15位包含字母和数字，可包含_和.)

| 参数名 | 参数说明 | 数据类型 | 备注     |
| ------ | -------- | -------- | -------- |
| oldPwd | 旧密码   | string   | 不为null |
| newPwd | 新密码   | string   | 不为null |

- 响应参数

| 状态码(status)   | 返回参数及说明                               | 额外返回参数 |
| ---------------- | -------------------------------------------- | ------------ |
| sendStatusHandle |                                              |              |
| 401              | token无效                                    |              |
| 403              | 旧密码错误                                   |              |
| 403              | 密码为6～15位且必须包含字母，可包含下划线和. |              |

#### 4. 填写健康卡

- 请求路径：/common/sethealth
- 请求方法：post
- 请求参数

| 参数名       | 参数说明                      | 数据类型                  | 备注（全部不为null）                              |
| ------------ | ----------------------------- | ------------------------- | ------------------------------------------------- |
| temperature  | 今日体温                      | string(js没有float，修改) |                                                   |
| address      | 当日居住地址                  | stirng                    |                                                   |
| healthy_code | 健康码颜色                    | int                       | (0.绿色 1.黄色 2.红色)                            |
| go_add       | 近14天是否去过中高风险地区    | int                       | (0.否 1.是) 下面都一样                            |
| exposure     | 近14天是否接触过接诊/红码人员 | int                       |                                                   |
| leave_out    | 今日是否离开学校              | int                       |                                                   |
| detection    | 48小时内是否检测过核酸        | int                       |                                                   |
| vaccines     | 疫苗接种情况                  | int                       | (0.未接种 1.已接种一针 2.已接种两针 3.已接种三针) |
| mask         | 口罩是否充足                  | int                       |                                                   |
| disinfect    | 消毒用品是否充足              | int                       |                                                   |
| mask_num     | 口罩剩余数量                  | int                       |                                                   |

- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |
| 403              | 今日已填报！   |              |

#### 5. 获取个人信息

- 请求路径：/getselfinfo
- 请求方法：get
- 请求参数
- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 403              | 用户不存在     |              |

### 2. 学生部分

#### 1. 请假

- 请求路径：/student/setleave
- 请求方法：post
- 请求参数

| 参数名    | 参数说明     | 数据类型 | 备注（全部不为null） |
| --------- | ------------ | -------- | -------------------- |
| reason    | 请假理由     | string   |                      |
| leaveType | 请假类型     | int      | (0.事假 1.病假)      |
| startTime | 请假开始时间 | string   |                      |
| endTime   | 请假结束时间 | string   |                      |

- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |

#### 2. 我的通知分页获取数据与数量

- 请求路径：/student/getnotice
- 请求方法：get
- 

- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |

#### 4. 我的通知修改(未读转已读)

- 请求路径：/student/editnoticestatu
- 请求方法：patch
- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |

#### 5. 获取本班辅导员信息

- 请求路径：/student/getteacher
- 请求方法：get
- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| unPermission      |                |              |
| queryStatusHandle |                |              |

#### 6. 获取今日健康卡信息

- 请求路径：/student/gethealcard
- 请求方法：get
- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| 401               |                |              |
| queryStatusHandle |                |              |

#### 7. 获取我的所有假条

- 请求路径：/student/getleavelist
- 请求方法：post
- 请求参数

| 参数名   | 参数说明 | 数据类型 | 备注 |
| -------- | -------- | -------- | ---- |
| pageNum  |          |          |      |
| currPage |          |          |      |

- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| 401               |                |              |
| queryStatusHandle |                |              |

### 3. 管理员部分

#### 1. 获取当天所有健康卡

- 请求路径：/admin/nowdaycardpage
- 请求方法：get
- 请求参数

| 参数名   | 参数说明   | 数据类型 | 备注（全部不为null） |
| -------- | ---------- | -------- | -------------------- |
| pageNum  | 当前页数   | int      |                      |
| currPage | 一个多少个 | int      |                      |

- 响应参数(unPermission：403 queryStatusHandle： 200、417)

| 状态码(status) | 返回参数及说明                             | 额外返回参数 |
| -------------- | ------------------------------------------ | ------------ |
| 200            | queryData                                  |              |
| 401            | token无效                                  |              |
| 403            | 没有访问权限（只有管理员和老师才可以访问） |              |
| 417            | 由于网络问题，获取失败！                   |              |

#### 2. 根据学号获取当天某用户报表

- 请求路径：/admin/nowdaycardbynumber
- 请求方法：post
- 请求参数

| 参数名   | 参数说明 | 数据类型 | 备注     |
| -------- | -------- | -------- | -------- |
| u_number | 编号     | string   | 不为null |

- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| unPermission      |                |              |
| queryStatusHandle |                |              |
| 401               | token无效      |              |
| 403               | 用户不存在     |              |

#### 4. 获取当月报表

- 请求路径：/admin/monthdaycardpage
- 请求方法：post
- 请求参数

| 参数名   | 参数说明 | 数据类型 | 备注 |
| -------- | -------- | -------- | ---- |
| pageNum  |          |          |      |
| currPage |          |          |      |

- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| unPermission      |                |              |
| queryStatusHandle |                |              |
| 401               | token无效      |              |
| 403               | 用户不存在     |              |

#### 5. 获取所有报表

- /admin/getallhealth
- post

其余同4

#### 6. 根据用户类型进行用户信息获取(分页获取总数量与数据)

- 请求路径：/admin/getusersbytp
- 请求方法：post
- 请求参数

| 参数名      | 参数说明 | 数据类型 | 备注                       |
| ----------- | -------- | -------- | -------------------------- |
| type        | 用户类型 | int      | （1.管理员 2.学生 3.老师） |
| pageNum     |          |          |                            |
| currentPage |          |          |                            |

- 响应参数
- 同4

#### 7. 用户删除(同时清空该用户阅读记录)

- 请求路径：/users/deluserdata?u_number=?
- 请求方法：delete
- 请求参数：看路径
- 响应参数

| 状态码(status)   | 返回参数及说明                 | 额外返回参数 |
| ---------------- | ------------------------------ | ------------ |
| sendStatusHandle |                                |              |
| 403              | 用户不存在                     |              |
| 417              | 错误的操作，不可以删除管理员！ |              |

#### 8. 添加用户

#### 通过xslx文件添加(密码初始为123456)

##### 1. 上传xlsx文件

- 请求路径：/file/upload
- 请求方法：post
- 请求参数：xlsx: xlsx文件

| 参数名   | 参数说明 | 数据类型 | 备注(默认不为null) |
| -------- | -------- | -------- | ------------------ |
| u_number | 用户编号 | string   |                    |
| userName | 姓名     |          |                    |
| mailbox  | 邮箱     |          | 可为null           |
| sex      | 性别     |          |                    |
| address  | 籍贯     |          |                    |
| classes  | 班级     |          |                    |
| type     | 类型     |          |                    |

- 响应参数

| 状态码(status) | 返回参数及说明           | 额外返回参数 |
| -------------- | ------------------------ | ------------ |
| 200            | message: "上传成功！"    |              |
| 401            | token无效                |              |
| 417            | 文件格式错误，上传失败！ |              |
| 417            | 由于网络问题，操作失败！ |              |

##### 2. 添加操作（已删除，与1合并）

- 请求路径：/users/setxslxdata
- 请求方法：get
- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |
| 403              | 用户已存在     |              |

#### 单个添加

- 请求路径：/users/setxuser
- 请求方法：post
- 请求参数(密码初始为123456)

| 参数名   | 参数说明 | 数据类型 | 备注(默认不为null) |
| -------- | -------- | -------- | ------------------ |
| u_number | 用户编号 | string   |                    |
| userName | 姓名     |          |                    |
| mailbox  | 邮箱     |          | 可为null           |
| sex      | 性别     |          |                    |
| address  | 籍贯     |          |                    |
| classes  | 班级     |          |                    |
| type     | 类型     |          |                    |

- 响应参数

- | 状态码(status)   | 返回参数及说明           | 额外返回参数 |
  | ---------------- | ------------------------ | ------------ |
  | sendStatusHandle |                          |              |
  | 401              | token无效                |              |
  | 417              | 文件格式错误，导入失败！ |              |
  | 417              | 表格数据错误，导入失败！ |              |

#### 9. 用户信息修改

- 请求路径：/users/upuserdata
- 请求方法：patch
- 请求参数

| 参数名     | 参数说明         | 数据类型 | 备注(默认可为null) |
| ---------- | ---------------- | -------- | ------------------ |
| q_u_number | 要修改的用户编号 | string   | 不为null           |
| n_userName | 姓名             |          |                    |
| n_mailbox  | 邮箱             |          |                    |
| n_sex      | 性别             |          |                    |
| n_address  | 籍贯             |          |                    |
| n_classes  | 班级             |          |                    |
| n_type     | 类型             |          |                    |

- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |
| 403              | 用户不存在     |              |

#### 10. 发送通知

- 请求路径：/teacher/announce
- 请求方法：post
- 请求参数

| 参数名  | 参数说明 | 数据类型 | 备注(全部不为null) |
| ------- | -------- | -------- | ------------------ |
| title   | 通知标题 | string   |                    |
| content | 通知内容 | string   |                    |
| classes | 通知班级 | array    |                    |

- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |
| 403              | 用户不存在     |              |

#### 11. 通知删除功能

#### 12. 获取14日内去过高风险地区的人数

- 请求路径：/admin/gethigh
- 请求方法：get
- 请求参数
- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |

#### 13. 获取今日核酸人数

/admin/getdetection

#### 14. 今日离校人数

/admin/getleaveout

#### 15. 根据编号查询学生

- 请求路径：/users/getinfobynum
- 请求方法：post
- 请求参数

| 参数名   | 参数说明 | 数据类型 | 备注(全部不为null) |
| -------- | -------- | -------- | ------------------ |
| u_number | 学号     | string   |                    |

- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| unPermission      |                |              |
| queryStatusHandle |                |              |
| 401               | token无效      |              |

#### 16. 查询所有学生及总和且按班级排序

- 请求路径：/admin/getstubyclass
- 请求方法：get
- 请求参数
- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| unPermission      |                |              |
| queryStatusHandle |                |              |
| 401               | token无效      |              |

#### 17.通过辅导员获取所有班级

- 请求路径：/admin/getallclasses
- 请求方法：get
- 请求参数
- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| unPermission      |                |              |
| queryStatusHandle |                |              |
| 401               | token无效      |              |

### 3. 老师部分

#### 1. 获取该老师所属班级的全部请假单与数量(分页查询)

- 请求路径：/teacher/getleave
- 请求方法：post
- 请求参数

| 参数名   | 参数说明 | 数据类型 | 备注 |
| -------- | -------- | -------- | ---- |
| pageNum  |          |          |      |
| currPage |          |          |      |

- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| unPermission      |                |              |
| queryStatusHandle |                |              |
| 401               | token无效      |              |

#### 2. 获取该班级所有未审批的请假条

- 请求路径：/teacher/notapproved
- 请求方法：get
- 请求参数
- 响应参数

| 状态码(status)    | 返回参数及说明 | 额外返回参数 |
| ----------------- | -------------- | ------------ |
| unPermission      |                |              |
| queryStatusHandle |                |              |
| 401               | token无效      |              |

#### 3. 当前请假单审批(修改审批状态)

- 请求路径：/teacher/upleavestate
- 请求方法：post
- 请求参数

| 参数名  | 参数说明         | 数据类型 | 备注                |
| ------- | ---------------- | -------- | ------------------- |
| l_id    | 要审批的请假条id |          |                     |
| upState | 审批状态         |          | (1. 通过 2. 不通过) |

- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |

#### 4. 获取本班所有通知并返回未读人数

- 请求路径：/admin/getnotice
- 请求方法：post
- 请求参数

| 参数名   | 参数说明 | 数据类型 |
| -------- | -------- | -------- |
| pageNum  |          |          |
| currPage |          |          |

- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |

#### 5. 删除通知

- 请求路径：/teacher/delnotice
- 请求方法：post
- 请求参数

| 参数名 | 参数说明 | 数据类型 |
| ------ | -------- | -------- |
| a_id   |          |          |

- 响应参数

| 状态码(status)   | 返回参数及说明 | 额外返回参数 |
| ---------------- | -------------- | ------------ |
| sendStatusHandle |                |              |
| 401              | token无效      |              |